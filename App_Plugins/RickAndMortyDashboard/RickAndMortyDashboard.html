<!DOCTYPE html>
<html>
<head>
    <title>Rick and Morty Importer</title>
</head>
<body>

    <h2>Rick and Morty Importer</h2>

    <button id="importButton" style="display: block;">Import Rick and Morty Characters</button>


    <select id="characterDropdown" style="display: none;"></select>
    <button id="createButton" style="display: none;">Create Component</button>
    <br />
    <div id="loading" style="display: none;">LOADING...</div>
    <div id="characterDetails"></div>


    <script>
        var loadingElement = document.getElementById("loading");
        var characterDropdown = document.getElementById('characterDropdown');
        var importButton = document.getElementById("importButton");
        var createButton = document.getElementById("createButton");

        createButton.addEventListener('click', function () {
            var selectedCharacterId = characterDropdown.value;

            if (selectedCharacterId) {
                fetch('/umbraco/api/RickAndMortyDashboard/CreateCharacterContent/' + selectedCharacterId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to create character.');
                        }
                    })
                    .then(_ => { location.reload(); })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error creating character.');
                    });
            } else {
                alert('Please select a character before creating.');
            }

        });

        importButton.addEventListener('click', function () {

            loadingElement.style.display = "block";

            fetch('/umbraco/api/RickAndMortyDashboard/ImportRickAndMortyCharacters', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch data from the API.');
                    }
                    createButton.style.display = "none";
                    loadingElement.style.display = "none";
                    importButton.style.display = "block";
                    characterDropdown.style.display = "none";
                    return response.json();
                })
                .then(data => {

                    var dropdown = document.getElementById('characterDropdown');
                    var detailsDiv = document.getElementById('characterDetails');

                    dropdown.innerHTML = '';

                    var defaultOption = document.createElement('option');
                    defaultOption.text = 'Select a character';
                    dropdown.add(defaultOption);

                    for (var i = 0; i < data.length; i++) {
                        var character = data[i];

                        var option = document.createElement('option');
                        option.value = character.id;
                        option.text = character.name;
                        dropdown.add(option);
                    }

                    dropdown.addEventListener('change', function () {
                        var selectedCharacterId = dropdown.value;

                        var selectedCharacterData = data.find(function (character) {
                            return character.id.toString() === selectedCharacterId;
                        });

                        detailsDiv.innerHTML = '<h3>' + selectedCharacterData.name + '</h3>' +
                            '<img src="' + selectedCharacterData.image + '" alt="Image of ' + selectedCharacterData.name + '">' +
                            '<ul>' +
                            '<li>Status: ' + selectedCharacterData.status + '</li>' +
                            '<li>Species: ' + selectedCharacterData.species + '</li>' +
                            (selectedCharacterData.type ? '<li>Type: ' + selectedCharacterData.type + '</li>' : '') +
                            '<li>Gender: ' + selectedCharacterData.gender + '</li>' +
                            '<li>origin: ' + selectedCharacterData.origin.name + '</li>' +
                            '<li>location: ' + selectedCharacterData.location.name + '</li>' +
                            '</ul>';

                    });

                    createButton.style.display = "block";
                    loadingElement.style.display = "none";
                    importButton.style.display = "none";
                    characterDropdown.style.display = "block";
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error importing data.');

                    createButton.style.display = "none";
                    loadingElement.style.display = "none";
                    importButton.style.display = "block";
                    characterDropdown.style.display = "none";
                });
        })
    </script>

</body>
</html>
